{% extends 'base.html' %}
{% block content %}
<div class="row g-4 mb-4">
  <div class="col-12">
    <h1 class="h3 mb-2">{{ t('data_import.title') }}</h1>
    <p class="text-muted">{{ t('data_import.subtitle') }}</p>
  </div>
</div>

<div class="row g-4" id="data-import-cards">
  {% for obj in data_import_objects %}
    <div class="col-12 col-md-6 col-xl-4">
      <div class="card shadow-sm data-import-card" data-object="{{ obj.key }}">
        <div class="card-body d-flex flex-column gap-3">
          <div>
            <div class="d-flex justify-content-between align-items-start gap-3">
              <h2 class="h5 mb-0">{{ obj.label }}</h2>
              <span class="badge bg-secondary data-import-badge" data-state="empty">{{ t('data_import.upload.optional') }}</span>
            </div>
            <p class="text-muted small mb-0">{{ t('data_import.upload.instructions') }}</p>
          </div>
          <div class="data-import-file-picker">
            <label class="form-label" for="file-{{ obj.key }}">{{ t('data_import.upload.select_label') }}</label>
            <input
              class="form-control data-import-input"
              type="file"
              id="file-{{ obj.key }}"
              accept=".xlsx,.xls,.csv"
              data-object="{{ obj.key }}"
            />
          </div>
          <div class="data-import-status" data-status="empty">
            <p class="text-muted small mb-0">{{ t('data_import.upload.not_loaded') }}</p>
          </div>
          <div class="data-import-status d-none" data-status="loaded">
            <p class="mb-1 small"><strong>{{ t('data_import.upload.file_label') }}</strong> <span class="data-import-file-name"></span></p>
            <p class="mb-1 small"><strong>{{ t('data_import.upload.record_count') }}</strong> <span class="data-import-record-count"></span></p>
            <p class="mb-2 small text-muted"><strong>{{ t('data_import.upload.updated_at') }}</strong> <span class="data-import-updated-at"></span></p>
            <button type="button" class="btn btn-outline-danger btn-sm data-import-remove">{{ t('data_import.upload.remove_button') }}</button>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

<div class="row g-4 align-items-start mt-4" id="data-import-explorer">
  <div class="col-12 col-xl-5">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h2 class="h5 mb-3">{{ t('data_import.search.title') }}</h2>
        <form id="data-import-search" class="vstack gap-3">
          <div>
            <label class="form-label" for="data-import-object">{{ t('data_import.search.object_label') }}</label>
            <select id="data-import-object" class="form-select"></select>
          </div>
          <div>
            <label class="form-label" for="data-import-field">{{ t('data_import.search.field_label') }}</label>
            <select id="data-import-field" class="form-select" disabled></select>
          </div>
          <div>
            <label class="form-label" for="data-import-value">{{ t('data_import.search.value_label') }}</label>
            <input
              id="data-import-value"
              class="form-control"
              type="search"
              placeholder="{{ t('data_import.search.value_placeholder') }}"
              list="data-import-suggestions"
              autocomplete="off"
            />
            <datalist id="data-import-suggestions"></datalist>
          </div>
          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">{{ t('data_import.search.submit') }}</button>
            <button type="button" class="btn btn-outline-secondary" id="data-import-reset">{{ t('data_import.search.reset') }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="col-12 col-xl-7">
    <div class="card shadow-sm h-100">
      <div class="card-body d-flex flex-column">
        <div class="d-flex justify-content-between align-items-start mb-3">
          <h2 class="h5 mb-0">{{ t('data_import.results.title') }}</h2>
          <span class="badge bg-secondary" id="data-import-result-count">0</span>
        </div>
        <div class="data-import-results flex-grow-1" id="data-import-results">
          <div class="text-muted small" id="data-import-placeholder">{{ t('data_import.results.placeholder') }}</div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  <script>
    window.DATA_IMPORT_OBJECTS = {{ data_import_objects | tojson }};
    window.DATA_IMPORT_STATUS = {{ data_import_status | tojson }};
  </script>
  <script src="{{ url_for('static', filename='data-import.js') }}" defer></script>
{% endblock %}
